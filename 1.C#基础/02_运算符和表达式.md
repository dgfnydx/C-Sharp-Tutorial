# C# 运算符和表达式

## 介绍

运算符是用于执行特定操作的符号，而表达式是由变量、常量和运算符组合而成的代码片段，用于计算某个值。理解运算符和表达式对于编写有效的C#代码至关重要。

## 算术运算符

算术运算符用于执行基本的数学运算：

| 运算符 | 描述 | 示例 | 结果 |
|--------|------|------|------|
| `+` | 加法 | `5 + 3` | `8` |
| `-` | 减法 | `5 - 3` | `2` |
| `*` | 乘法 | `5 * 3` | `15` |
| `/` | 除法 | `5 / 3` | `1`（整数除法）或`1.6666...`（浮点除法） |
| `%` | 取余（模） | `5 % 3` | `2` |
| `++` | 递增 | `i++`或`++i` | 将变量值加1 |
| `--` | 递减 | `i--`或`--i` | 将变量值减1 |

### 前缀和后缀递增/递减

前缀形式（`++i`）先增加变量的值，然后返回新值。
后缀形式（`i++`）先返回变量的当前值，然后增加变量的值。

```csharp
int a = 5;
int b = ++a;  // a先增加到6，然后b被赋值为6

int c = 5;
int d = c++;  // d被赋值为5，然后c增加到6
```

## 赋值运算符

赋值运算符用于给变量赋值：

| 运算符 | 描述 | 示例 | 等价于 |
|--------|------|------|--------|
| `=` | 简单赋值 | `x = 5` | `x = 5` |
| `+=` | 加法赋值 | `x += 3` | `x = x + 3` |
| `-=` | 减法赋值 | `x -= 3` | `x = x - 3` |
| `*=` | 乘法赋值 | `x *= 3` | `x = x * 3` |
| `/=` | 除法赋值 | `x /= 3` | `x = x / 3` |
| `%=` | 取余赋值 | `x %= 3` | `x = x % 3` |

## 比较运算符

比较运算符用于比较两个值，返回一个布尔值（`true`或`false`）：

| 运算符 | 描述 | 示例 | 结果 |
|--------|------|------|------|
| `==` | 等于 | `5 == 3` | `false` |
| `!=` | 不等于 | `5 != 3` | `true` |
| `>` | 大于 | `5 > 3` | `true` |
| `<` | 小于 | `5 < 3` | `false` |
| `>=` | 大于或等于 | `5 >= 5` | `true` |
| `<=` | 小于或等于 | `5 <= 3` | `false` |

## 逻辑运算符

逻辑运算符用于组合布尔表达式：

| 运算符 | 描述 | 示例 | 结果 |
|--------|------|------|------|
| `&&` | 逻辑与（AND） | `true && false` | `false` |
| `\|\|` | 逻辑或（OR） | `true \|\| false` | `true` |
| `!` | 逻辑非（NOT） | `!true` | `false` |

### 短路求值

逻辑运算符使用短路求值：
- 对于`&&`，如果第一个操作数为`false`，则不会计算第二个操作数。
- 对于`||`，如果第一个操作数为`true`，则不会计算第二个操作数。

```csharp
bool result = (5 > 10) && (DoSomething());  // DoSomething()不会被调用
```

## 位运算符

位运算符用于对整数的二进制位进行操作：

| 运算符 | 描述 | 示例 | 结果 |
|--------|------|------|------|
| `&` | 按位与 | `5 & 3` | `1` |
| `\|` | 按位或 | `5 \| 3` | `7` |
| `^` | 按位异或 | `5 ^ 3` | `6` |
| `~` | 按位取反 | `~5` | `-6` |
| `<<` | 左移 | `5 << 1` | `10` |
| `>>` | 右移 | `5 >> 1` | `2` |

## 条件运算符（三元运算符）

条件运算符`?:`是C#中唯一的三元运算符，用于根据条件返回不同的值：

```csharp
// 语法：条件 ? 如果条件为true的值 : 如果条件为false的值
int x = 10;
int y = 20;
int max = (x > y) ? x : y;  // max将被赋值为20
```

## 空合并运算符

空合并运算符`??`用于提供一个默认值，当左操作数为`null`时返回右操作数：

```csharp
string name = null;
string displayName = name ?? "未知用户";  // displayName将被赋值为"未知用户"
```

## 空条件运算符

空条件运算符`?.`用于安全地访问可能为`null`的对象的成员：

```csharp
Person person = null;
int? age = person?.Age;  // 不会抛出NullReferenceException，age将为null
```

## 运算符优先级

C#中的运算符按照一定的优先级顺序执行。以下是从高到低的优先级顺序（部分列表）：

1. 基本运算符：`()`（括号）、`[]`（索引）、`.`（成员访问）、`?`（条件访问）
2. 一元运算符：`+`、`-`、`!`、`~`、`++`、`--`、`(type)`（类型转换）
3. 乘法运算符：`*`、`/`、`%`
4. 加法运算符：`+`、`-`
5. 移位运算符：`<<`、`>>`
6. 关系运算符：`<`、`>`、`<=`、`>=`、`is`、`as`
7. 相等运算符：`==`、`!=`
8. 按位与：`&`
9. 按位异或：`^`
10. 按位或：`|`
11. 逻辑与：`&&`
12. 逻辑或：`||`
13. 条件运算符：`?:`
14. 赋值运算符：`=`、`+=`、`-=`等

如果不确定运算符的优先级，可以使用括号`()`来明确指定计算顺序。

## 表达式

表达式是由变量、常量、运算符和方法调用组成的代码片段，用于计算一个值。表达式可以是简单的，如单个变量或常量，也可以是复杂的，包含多个运算符和操作数。

### 表达式类型

1. **算术表达式**：执行数学运算
   ```csharp
   int result = 10 + 5 * 2;  // 结果为20
   ```

2. **关系表达式**：比较值
   ```csharp
   bool isGreater = 10 > 5;  // 结果为true
   ```

3. **逻辑表达式**：组合布尔值
   ```csharp
   bool result = (10 > 5) && (6 < 8);  // 结果为true
   ```

4. **字符串表达式**：连接字符串
   ```csharp
   string fullName = "张" + "三";  // 结果为"张三"
   ```

5. **赋值表达式**：给变量赋值
   ```csharp
   int x = 10;  // x被赋值为10
   ```

## 字符串插值

C#提供了一种简洁的方式来创建包含变量和表达式的字符串，称为字符串插值。使用`$`前缀和`{}`括号：

```csharp
string name = "张三";
int age = 30;
string message = $"{name}今年{age}岁。";  // 结果为"张三今年30岁。"
```

## 代码示例

下面是一个综合使用各种运算符和表达式的完整示例：

```csharp
using System;

class Program
{
    static void Main()
    {
        // 算术运算符
        int a = 10;
        int b = 3;
        
        Console.WriteLine($"加法: {a} + {b} = {a + b}");
        Console.WriteLine($"减法: {a} - {b} = {a - b}");
        Console.WriteLine($"乘法: {a} * {b} = {a * b}");
        Console.WriteLine($"整数除法: {a} / {b} = {a / b}");
        Console.WriteLine($"浮点除法: {a} / {b} = {(double)a / b}");
        Console.WriteLine($"取余: {a} % {b} = {a % b}");
        
        // 递增和递减
        int c = 5;
        Console.WriteLine($"原始值: {c}");
        Console.WriteLine($"后缀递增: {c++}");  // 输出5，然后c变为6
        Console.WriteLine($"当前值: {c}");       // 输出6
        Console.WriteLine($"前缀递增: {++c}");  // c变为7，然后输出7
        
        // 赋值运算符
        int d = 10;
        d += 5;  // 等价于 d = d + 5
        Console.WriteLine($"加法赋值后: {d}");  // 输出15
        
        // 比较运算符
        int x = 5;
        int y = 10;
        Console.WriteLine($"{x} == {y}: {x == y}");  // false
        Console.WriteLine($"{x} != {y}: {x != y}");  // true
        Console.WriteLine($"{x} > {y}: {x > y}");    // false
        Console.WriteLine($"{x} < {y}: {x < y}");    // true
        
        // 逻辑运算符
        bool condition1 = true;
        bool condition2 = false;
        Console.WriteLine($"{condition1} && {condition2}: {condition1 && condition2}");  // false
        Console.WriteLine($"{condition1} || {condition2}: {condition1 || condition2}");  // true
        Console.WriteLine($"!{condition1}: {!condition1}");  // false
        
        // 条件运算符
        int age = 20;
        string status = (age >= 18) ? "成年" : "未成年";
        Console.WriteLine($"年龄{age}，状态: {status}");  // 输出"年龄20，状态: 成年"
        
        // 空合并运算符
        string name = null;
        string displayName = name ?? "游客";
        Console.WriteLine($"欢迎, {displayName}");  // 输出"欢迎, 游客"
        
        // 复杂表达式
        int result = (a + b) * (c - d) / 2;
        Console.WriteLine($"复杂表达式结果: {result}");
    }
}
```

## 练习

1. 编写一个程序，使用算术运算符计算两个数的和、差、积、商和余数。

2. 创建一个程序，使用条件运算符根据用户输入的年龄判断其是否可以投票（假设18岁及以上可以投票）。

3. 编写一个程序，使用逻辑运算符组合多个条件，例如判断一个数是否在特定范围内。

4. 使用字符串插值创建一个包含多个变量的格式化消息。

## 下一步学习

掌握了运算符和表达式后，你可以继续学习[控制流语句](03_控制流语句.md)，了解如何使用条件语句和循环来控制程序的执行流程。